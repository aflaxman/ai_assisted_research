<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PPV Calculator | IHME Simulation Science</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f8f9fa;
      color: #1a1a1a;
      line-height: 1.5;
    }

    .container { max-width: 960px; margin: 0 auto; }

    header {
      margin-bottom: 20px;
    }

    h1 {
      font-size: 1.6rem;
      font-weight: 600;
      margin: 0 0 4px 0;
      color: #2c3e50;
    }

    .branding {
      font-size: 0.75rem;
      color: #2980b9;
      font-weight: 500;
      letter-spacing: 0.3px;
    }

    .subtitle {
      color: #5a6c7d;
      margin: 8px 0 0 0;
      font-size: 0.9rem;
    }

    /* Top section: PPV + Parameters side by side on wide screens */
    .top-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: #fff;
      border: 1px solid #e1e5e9;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }

    .card-title {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #5a6c7d;
      margin: 0 0 12px 0;
    }

    /* PPV Result */
    .result-card {
      flex: 0 0 auto;
      min-width: 180px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .ppv-label {
      font-size: 0.8rem;
      color: #5a6c7d;
      margin-bottom: 4px;
    }

    .ppv-value {
      font-size: 3rem;
      font-weight: 700;
      color: #2980b9;
      line-height: 1;
      cursor: help;
      position: relative;
    }

    .ppv-warning {
      color: #c0392b;
      font-size: 0.8rem;
      margin-top: 6px;
      min-height: 1.2em;
    }

    /* Tooltip for formula */
    .tooltip-trigger {
      position: relative;
      display: inline-block;
    }

    .tooltip-content {
      visibility: hidden;
      opacity: 0;
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #2c3e50;
      color: #fff;
      padding: 12px 14px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-family: "SF Mono", Monaco, "Cascadia Code", monospace;
      white-space: nowrap;
      z-index: 100;
      margin-bottom: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: opacity 0.2s, visibility 0.2s;
    }

    .tooltip-content::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: #2c3e50;
    }

    .tooltip-trigger:hover .tooltip-content,
    .tooltip-trigger:focus .tooltip-content {
      visibility: visible;
      opacity: 1;
    }

    .tooltip-line { margin-bottom: 3px; }
    .tooltip-line:last-child { margin-bottom: 0; }
    .tooltip-dim { opacity: 0.7; }

    /* Parameters card */
    .params-card {
      flex: 1;
    }

    .params-layout {
      display: flex;
      gap: 24px;
      align-items: flex-start;
    }

    /* Vertical sliders */
    .sliders-group {
      display: flex;
      gap: 16px;
    }

    .slider-col {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .slider-col label {
      font-size: 0.7rem;
      font-weight: 500;
      color: #5a6c7d;
    }

    input[type="range"].vertical {
      -webkit-appearance: slider-vertical;
      appearance: slider-vertical;
      writing-mode: vertical-lr;
      direction: rtl;
      width: 20px;
      height: 100px;
      background: transparent;
    }

    input[type="range"].vertical::-webkit-slider-runnable-track {
      width: 5px;
      background: #e1e5e9;
      border-radius: 3px;
    }

    input[type="range"].vertical::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: #2980b9;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      margin-left: -5px;
    }

    input[type="range"].vertical::-moz-range-track {
      width: 5px;
      background: #e1e5e9;
      border-radius: 3px;
    }

    input[type="range"].vertical::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: #2980b9;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }

    .slider-value {
      font-size: 0.75rem;
      color: #34495e;
      font-weight: 500;
    }

    /* Text inputs */
    .inputs-group { flex: 1; }

    .input-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .input-row:last-child { margin-bottom: 0; }

    .input-label {
      width: 80px;
      font-size: 0.85rem;
      font-weight: 500;
      color: #34495e;
    }

    input[type="number"] {
      width: 60px;
      padding: 5px 6px;
      font-size: 0.85rem;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      text-align: right;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: #2980b9;
      box-shadow: 0 0 0 2px rgba(41,128,185,0.15);
    }

    .unit {
      font-size: 0.8rem;
      color: #5a6c7d;
    }

    /* Prevalence section */
    .prevalence-card {
      margin-bottom: 20px;
    }

    .prevalence-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
      gap: 16px;
    }

    .prevalence-title-group {
      flex: 1;
    }

    .prevalence-desc {
      font-size: 0.75rem;
      color: #7f8c8d;
      margin-top: 4px;
    }

    .prevalence-content {
      display: flex;
      gap: 16px;
    }

    /* Prevalence table */
    .prevalence-table-wrap {
      flex: 1;
      overflow-x: auto;
    }

    .prevalence-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    .prevalence-table th {
      text-align: center;
      padding: 6px 8px;
      background: #f8f9fa;
      border-bottom: 2px solid #e1e5e9;
      font-weight: 600;
      color: #5a6c7d;
      cursor: pointer;
    }

    .prevalence-table th:hover {
      background: #eef2f5;
    }

    .prevalence-table th.selected {
      background: #e8f4fc;
      color: #2980b9;
    }

    .prevalence-table th:first-child {
      text-align: left;
    }

    .prevalence-table .subheader {
      font-size: 0.65rem;
      font-weight: 500;
    }

    .prevalence-table td {
      padding: 5px 8px;
      border-bottom: 1px solid #e9ecef;
      text-align: center;
    }

    .prevalence-table td:first-child {
      text-align: left;
      font-weight: 500;
      color: #5a6c7d;
      cursor: pointer;
    }

    .prevalence-table td:first-child:hover {
      background: #f0f7fc;
    }

    .prevalence-table td:first-child.selected {
      background: #e8f4fc;
      color: #2980b9;
    }

    .prevalence-table tbody tr:hover td:not(:first-child) {
      background: #fafbfc;
    }

    /* Individual cells for F/M values */
    .cell-pair {
      display: flex;
      justify-content: center;
      gap: 2px;
    }

    .cell-val {
      padding: 3px 6px;
      border-radius: 3px;
      cursor: pointer;
      transition: background 0.1s;
      min-width: 36px;
    }

    .cell-val:hover {
      background: #e8f4fc;
    }

    .cell-val.selected {
      background: #2980b9;
      color: #fff;
      font-weight: 600;
    }

    .cell-val.female { color: #8e44ad; }
    .cell-val.male { color: #2980b9; }
    .cell-val.selected { color: #fff; }

    /* Map */
    .map-container {
      width: 140px;
      flex-shrink: 0;
      text-align: center;
    }

    .map-svg {
      width: 100%;
      height: auto;
    }

    .map-svg .land {
      fill: #e1e5e9;
      stroke: #fff;
      stroke-width: 0.5;
    }

    .map-svg .country {
      fill: #cfd8dc;
      stroke: #fff;
      stroke-width: 0.5;
      transition: fill 0.2s;
      cursor: pointer;
    }

    .map-svg .country.active { fill: #2980b9; }
    .map-svg .country:hover { fill: #5dade2; }

    .map-label {
      font-size: 0.7rem;
      color: #5a6c7d;
      margin-top: 4px;
    }

    footer {
      text-align: center;
      font-size: 0.75rem;
      color: #7f8c8d;
      padding: 12px 0;
    }

    /* Responsive: stack on narrow screens */
    @media (max-width: 700px) {
      .top-row {
        flex-direction: column;
      }

      .result-card {
        min-width: auto;
      }

      .params-layout {
        flex-direction: column;
        align-items: center;
        gap: 16px;
      }

      .sliders-group {
        justify-content: center;
      }

      .inputs-group {
        width: 100%;
      }

      .prevalence-content {
        flex-direction: column;
      }

      .map-container {
        width: 100%;
        max-width: 160px;
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="branding">IHME Simulation Science Team</div>
      <h1>Positive Predictive Value Calculator</h1>
      <p class="subtitle">Calculate PPV from sensitivity, specificity, and prevalence</p>
    </header>

    <!-- Top row: PPV result + Parameters -->
    <div class="top-row">
      <!-- PPV Result -->
      <div class="card result-card">
        <div class="ppv-label">Positive Predictive Value</div>
        <div class="tooltip-trigger" tabindex="0">
          <span class="ppv-value" id="ppvValue">35.7%</span>
          <div class="tooltip-content" id="tooltipContent">
            <!-- Populated by JS -->
          </div>
        </div>
        <div class="ppv-warning" id="ppvWarning"></div>
      </div>

      <!-- Parameters -->
      <div class="card params-card">
        <h2 class="card-title">Parameters</h2>
        <div class="params-layout">
          <div class="sliders-group">
            <div class="slider-col">
              <label>Se</label>
              <input type="range" class="vertical" id="sensitivitySlider"
                     min="0" max="100" step="1" value="50" tabindex="-1">
              <span class="slider-value" id="seSliderVal">50</span>
            </div>
            <div class="slider-col">
              <label>Sp</label>
              <input type="range" class="vertical" id="specificitySlider"
                     min="0" max="100" step="1" value="90" tabindex="-1">
              <span class="slider-value" id="spSliderVal">90</span>
            </div>
            <div class="slider-col">
              <label>Prev</label>
              <input type="range" class="vertical" id="prevalenceSlider"
                     min="0" max="100" step="1" value="10" tabindex="-1">
              <span class="slider-value" id="prevSliderVal">10</span>
            </div>
          </div>
          <div class="inputs-group">
            <div class="input-row">
              <label class="input-label" for="sensitivityNum">Sensitivity</label>
              <input type="number" id="sensitivityNum" min="0" max="100" step="1" value="50">
              <span class="unit">%</span>
            </div>
            <div class="input-row">
              <label class="input-label" for="specificityNum">Specificity</label>
              <input type="number" id="specificityNum" min="0" max="100" step="1" value="90">
              <span class="unit">%</span>
            </div>
            <div class="input-row">
              <label class="input-label" for="prevalenceNum">Prevalence</label>
              <input type="number" id="prevalenceNum" min="0" max="100" step="1" value="10">
              <span class="unit">%</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Prevalence Lookup -->
    <div class="card prevalence-card">
      <div class="prevalence-header">
        <div class="prevalence-title-group">
          <h2 class="card-title" style="margin-bottom:0">Prevalence of Preclinical Alzheimer's Disease</h2>
          <p class="prevalence-desc">Detectable using blood-based biomarker (BBBM) testing. Click a cell to set prevalence.</p>
        </div>
      </div>

      <div class="prevalence-content">
        <div class="prevalence-table-wrap">
          <table class="prevalence-table">
            <thead>
              <tr>
                <th>Age</th>
                <th id="colUS" data-location="United States">
                  United States
                  <div class="subheader">F / M</div>
                </th>
                <th id="colBrazil" data-location="Brazil">
                  Brazil
                  <div class="subheader">F / M</div>
                </th>
                <th id="colChina" data-location="China">
                  China
                  <div class="subheader">F / M</div>
                </th>
              </tr>
            </thead>
            <tbody id="prevalenceTableBody">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>

        <div class="map-container">
          <svg class="map-svg" viewBox="0 0 200 100" preserveAspectRatio="xMidYMid meet">
            <g class="land">
              <path d="M10,15 L50,10 L55,35 L40,50 L20,45 L10,30 Z"/>
              <path d="M35,52 L55,48 L60,70 L50,90 L35,85 L30,65 Z"/>
              <path d="M85,15 L110,12 L115,35 L105,50 L90,55 L80,40 Z"/>
              <path d="M85,58 L105,55 L110,80 L95,90 L80,85 L78,70 Z"/>
              <path d="M115,10 L180,8 L190,35 L175,55 L140,50 L115,35 Z"/>
              <path d="M160,65 L185,60 L190,80 L175,88 L158,82 Z"/>
            </g>
            <circle class="country" id="mapUS" cx="35" cy="30" r="8" data-location="United States"/>
            <circle class="country" id="mapBrazil" cx="50" cy="70" r="8" data-location="Brazil"/>
            <circle class="country" id="mapChina" cx="155" cy="32" r="8" data-location="China"/>
          </svg>
          <div class="map-label" id="mapLabel">Click to select</div>
        </div>
      </div>
    </div>

    <footer>PPV Calculator • IHME Simulation Science Team</footer>
  </div>

  <script>
    // =========================================================================
    // EXTENDABLE DATA
    // =========================================================================

    const LOCATIONS = ["United States", "Brazil", "China"];
    const AGE_GROUPS = ["60-64", "65-69", "70-74", "75-79", "80-84"];

    // Structure: { location: { sex: { ageGroup: prevalencePercent } } }
    const PREVALENCE_DATA = {
      "United States": {
        "Female": { "60-64": 8, "65-69": 11, "70-74": 15, "75-79": 21, "80-84": 28 },
        "Male":   { "60-64": 10, "65-69": 14, "70-74": 19, "75-79": 26, "80-84": 34 }
      },
      "Brazil": {
        "Female": { "60-64": 7, "65-69": 10, "70-74": 14, "75-79": 19, "80-84": 25 },
        "Male":   { "60-64": 9, "65-69": 12, "70-74": 17, "75-79": 23, "80-84": 30 }
      },
      "China": {
        "Female": { "60-64": 6, "65-69": 9, "70-74": 12, "75-79": 17, "80-84": 23 },
        "Male":   { "60-64": 8, "65-69": 11, "70-74": 15, "75-79": 21, "80-84": 28 }
      }
    };

    const LOCATION_MAP_IDS = {
      "United States": "mapUS",
      "Brazil": "mapBrazil",
      "China": "mapChina"
    };

    // =========================================================================
    // STATE
    // =========================================================================

    let selectedLocation = null;
    let selectedAge = null;
    let selectedSex = null;

    // =========================================================================
    // DOM ELEMENTS
    // =========================================================================

    const sensitivitySlider = document.getElementById('sensitivitySlider');
    const sensitivityNum = document.getElementById('sensitivityNum');
    const specificitySlider = document.getElementById('specificitySlider');
    const specificityNum = document.getElementById('specificityNum');
    const prevalenceSlider = document.getElementById('prevalenceSlider');
    const prevalenceNum = document.getElementById('prevalenceNum');

    const seSliderVal = document.getElementById('seSliderVal');
    const spSliderVal = document.getElementById('spSliderVal');
    const prevSliderVal = document.getElementById('prevSliderVal');

    const prevalenceTableBody = document.getElementById('prevalenceTableBody');

    const ppvValue = document.getElementById('ppvValue');
    const ppvWarning = document.getElementById('ppvWarning');
    const tooltipContent = document.getElementById('tooltipContent');
    const mapLabel = document.getElementById('mapLabel');

    // =========================================================================
    // UTILITY
    // =========================================================================

    function clampAndRound(val) {
      const num = parseFloat(val);
      if (isNaN(num)) return 0;
      return Math.max(0, Math.min(100, Math.round(num)));
    }

    // =========================================================================
    // PPV CALCULATION
    // =========================================================================

    function calculatePPV(sensitivityPct, specificityPct, prevalencePct) {
      const se = sensitivityPct / 100;
      const sp = specificityPct / 100;
      const prev = prevalencePct / 100;

      const truePos = se * prev;
      const falsePos = (1 - sp) * (1 - prev);
      const denom = truePos + falsePos;

      if (denom === 0) {
        return { ppv: null, numerator: truePos, denominator: denom, se, sp, prev };
      }

      return { ppv: truePos / denom, numerator: truePos, denominator: denom, se, sp, prev };
    }

    // =========================================================================
    // UI UPDATE
    // =========================================================================

    function syncFromSlider(slider, numInput, valDisplay) {
      numInput.value = slider.value;
      valDisplay.textContent = slider.value;
      updateCalculation();
    }

    function syncFromInput(slider, numInput, valDisplay) {
      const val = clampAndRound(numInput.value);
      numInput.value = val;
      slider.value = val;
      valDisplay.textContent = val;
      updateCalculation();
    }

    function updateCalculation() {
      const se = parseInt(sensitivityNum.value, 10);
      const sp = parseInt(specificityNum.value, 10);
      const prev = parseInt(prevalenceNum.value, 10);

      const result = calculatePPV(se, sp, prev);

      if (result.ppv === null) {
        ppvValue.textContent = '—';
        ppvWarning.textContent = 'Undefined: no positive tests occur';
        tooltipContent.innerHTML = '<div class="tooltip-line">Denominator is zero</div>';
      } else {
        ppvValue.textContent = (result.ppv * 100).toFixed(1) + '%';
        ppvWarning.textContent = '';
        tooltipContent.innerHTML = `
          <div class="tooltip-line tooltip-dim">Se=${result.se.toFixed(2)}, Sp=${result.sp.toFixed(2)}, Prev=${result.prev.toFixed(2)}</div>
          <div class="tooltip-line">PPV = (Se×Prev) / (Se×Prev + (1−Sp)×(1−Prev))</div>
          <div class="tooltip-line">PPV = ${result.numerator.toFixed(4)} / ${result.denominator.toFixed(4)}</div>
          <div class="tooltip-line">PPV = ${result.ppv.toFixed(4)}</div>
        `;
      }
    }

    // =========================================================================
    // PREVALENCE TABLE
    // =========================================================================

    function buildPrevalenceTable() {
      prevalenceTableBody.innerHTML = '';

      AGE_GROUPS.forEach(age => {
        const tr = document.createElement('tr');

        // Age cell (clickable to select age)
        const tdAge = document.createElement('td');
        tdAge.textContent = age.replace('-', '–');
        tdAge.dataset.age = age;
        tdAge.addEventListener('click', () => selectAge(age));
        tr.appendChild(tdAge);

        // Location cells with F/M values
        LOCATIONS.forEach(loc => {
          const td = document.createElement('td');
          const femaleVal = PREVALENCE_DATA[loc]?.["Female"]?.[age];
          const maleVal = PREVALENCE_DATA[loc]?.["Male"]?.[age];

          const cellPair = document.createElement('div');
          cellPair.className = 'cell-pair';

          // Female value
          const fSpan = document.createElement('span');
          fSpan.className = 'cell-val female';
          fSpan.textContent = femaleVal !== undefined ? `${femaleVal}%` : '—';
          fSpan.dataset.location = loc;
          fSpan.dataset.age = age;
          fSpan.dataset.sex = 'Female';
          fSpan.dataset.prevalence = femaleVal;
          fSpan.addEventListener('click', () => selectCell(age, loc, 'Female', femaleVal));
          cellPair.appendChild(fSpan);

          // Separator
          const sep = document.createElement('span');
          sep.textContent = '/';
          sep.style.color = '#bdc3c7';
          sep.style.padding = '0 2px';
          cellPair.appendChild(sep);

          // Male value
          const mSpan = document.createElement('span');
          mSpan.className = 'cell-val male';
          mSpan.textContent = maleVal !== undefined ? `${maleVal}%` : '—';
          mSpan.dataset.location = loc;
          mSpan.dataset.age = age;
          mSpan.dataset.sex = 'Male';
          mSpan.dataset.prevalence = maleVal;
          mSpan.addEventListener('click', () => selectCell(age, loc, 'Male', maleVal));
          cellPair.appendChild(mSpan);

          td.appendChild(cellPair);
          tr.appendChild(td);
        });

        prevalenceTableBody.appendChild(tr);
      });

      updateTableSelection();
    }

    function selectCell(age, location, sex, value) {
      if (value === undefined) return;

      selectedAge = age;
      selectedLocation = location;
      selectedSex = sex;

      prevalenceNum.value = value;
      prevalenceSlider.value = value;
      prevSliderVal.textContent = value;

      updateTableSelection();
      updateColumnHeaders();
      updateMapSelection();
      updateCalculation();
    }

    function selectAge(age) {
      // Keep current location/sex if available, just change age
      if (selectedLocation && selectedSex) {
        const val = PREVALENCE_DATA[selectedLocation]?.[selectedSex]?.[age];
        if (val !== undefined) {
          selectCell(age, selectedLocation, selectedSex, val);
          return;
        }
      }
      // Otherwise just update the age highlight
      selectedAge = age;
      updateTableSelection();
    }

    function selectLocation(location) {
      // Keep current age/sex if available, just change location
      if (selectedAge && selectedSex) {
        const val = PREVALENCE_DATA[location]?.[selectedSex]?.[selectedAge];
        if (val !== undefined) {
          selectCell(selectedAge, location, selectedSex, val);
          return;
        }
      }
      // Otherwise just update the location highlight
      selectedLocation = location;
      updateColumnHeaders();
      updateMapSelection();
    }

    function updateTableSelection() {
      // Clear cell selections
      document.querySelectorAll('.cell-val').forEach(el => {
        el.classList.remove('selected');
      });

      // Clear age selections
      document.querySelectorAll('#prevalenceTableBody td:first-child').forEach(el => {
        el.classList.remove('selected');
      });

      // Highlight selected cell
      if (selectedAge && selectedLocation && selectedSex) {
        const cell = document.querySelector(
          `.cell-val[data-age="${selectedAge}"][data-location="${selectedLocation}"][data-sex="${selectedSex}"]`
        );
        if (cell) cell.classList.add('selected');
      }

      // Highlight selected age row
      if (selectedAge) {
        const ageCell = document.querySelector(`#prevalenceTableBody td[data-age="${selectedAge}"]`);
        if (ageCell) ageCell.classList.add('selected');
      }
    }

    function updateColumnHeaders() {
      document.querySelectorAll('.prevalence-table th[data-location]').forEach(th => {
        th.classList.toggle('selected', th.dataset.location === selectedLocation);
      });
    }

    // =========================================================================
    // MAP
    // =========================================================================

    function updateMapSelection() {
      document.querySelectorAll('.map-svg .country').forEach(el => {
        el.classList.remove('active');
      });

      if (selectedLocation && LOCATION_MAP_IDS[selectedLocation]) {
        const el = document.getElementById(LOCATION_MAP_IDS[selectedLocation]);
        if (el) el.classList.add('active');
        mapLabel.textContent = selectedLocation;
      } else {
        mapLabel.textContent = 'Click to select';
      }
    }

    function initMap() {
      document.querySelectorAll('.map-svg .country').forEach(el => {
        el.addEventListener('click', () => {
          selectLocation(el.dataset.location);
        });
      });
    }

    function initColumnHeaders() {
      document.querySelectorAll('.prevalence-table th[data-location]').forEach(th => {
        th.addEventListener('click', () => {
          selectLocation(th.dataset.location);
        });
      });
    }

    // =========================================================================
    // EVENT LISTENERS
    // =========================================================================

    // Sliders
    sensitivitySlider.addEventListener('input', () => syncFromSlider(sensitivitySlider, sensitivityNum, seSliderVal));
    specificitySlider.addEventListener('input', () => syncFromSlider(specificitySlider, specificityNum, spSliderVal));
    prevalenceSlider.addEventListener('input', () => {
      syncFromSlider(prevalenceSlider, prevalenceNum, prevSliderVal);
      clearSelection();
    });

    // Number inputs
    sensitivityNum.addEventListener('input', () => syncFromInput(sensitivitySlider, sensitivityNum, seSliderVal));
    sensitivityNum.addEventListener('blur', () => syncFromInput(sensitivitySlider, sensitivityNum, seSliderVal));
    specificityNum.addEventListener('input', () => syncFromInput(specificitySlider, specificityNum, spSliderVal));
    specificityNum.addEventListener('blur', () => syncFromInput(specificitySlider, specificityNum, spSliderVal));
    prevalenceNum.addEventListener('input', () => {
      syncFromInput(prevalenceSlider, prevalenceNum, prevSliderVal);
      clearSelection();
    });
    prevalenceNum.addEventListener('blur', () => syncFromInput(prevalenceSlider, prevalenceNum, prevSliderVal));

    function clearSelection() {
      selectedAge = null;
      selectedLocation = null;
      selectedSex = null;
      updateTableSelection();
      updateColumnHeaders();
      updateMapSelection();
    }

    // =========================================================================
    // INIT
    // =========================================================================

    buildPrevalenceTable();
    initMap();
    initColumnHeaders();
    updateCalculation();

    // =========================================================================
    // TEST CASES
    // =========================================================================
    /*
    Test 1: Se=50%, Sp=90%, Prev=10%
      PPV = 0.05 / 0.14 = 0.3571 → 35.7% ✓

    Test 2: Se=90%, Sp=99%, Prev=1%
      PPV = 0.009 / 0.0189 = 0.4762 → 47.6%

    Test 3: Se=80%, Sp=100%, Prev=5%
      PPV = 0.04 / 0.04 = 1.0 → 100%

    Test 4: Se=0%, Sp=100% → denominator=0 → "—"
    */
  </script>
</body>
</html>
